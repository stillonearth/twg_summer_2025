<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Psychosis Spectrum Cards</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <style>
            body {
                background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e);
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 20px;
                min-height: 100vh;
                color: #e0e0e0;
            }

            .card {
                width: 300px;
                height: 480px;
                border-radius: 15px;
                box-shadow:
                    0 10px 30px rgba(0, 0, 0, 0.8),
                    0 0 0 2px #333,
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
                margin: 15px;
                display: inline-block;
                background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
                position: relative;
                overflow: hidden;
                transition:
                    transform 0.3s ease,
                    box-shadow 0.3s ease;
                border: 1px solid #444;
            }

            .card:hover {
                transform: translateY(-8px) scale(1.03);
                box-shadow:
                    0 15px 40px rgba(0, 0, 0, 0.9),
                    0 0 0 3px #555,
                    0 0 20px rgba(100, 100, 255, 0.3);
            }

            .card-header {
                background: linear-gradient(135deg, #1a1a1a, #333);
                border-radius: 15px 15px 0 0;
                padding: 12px 15px;
                position: relative;
                border-bottom: 2px solid #444;
            }

            .card-name {
                color: #e0e0e0;
                font-size: 18px;
                font-weight: bold;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
                margin: 0 0 5px 0;
                text-align: center;
            }

            .card-title {
                color: #b0b0b0;
                font-size: 14px;
                font-weight: normal;
                font-style: italic;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
                margin: 0;
                text-align: center;
            }

            .card-type {
                position: absolute;
                top: 8px;
                right: 10px;
                background: rgba(100, 100, 255, 0.8);
                color: #fff;
                padding: 3px 8px;
                border-radius: 6px;
                font-size: 10px;
                font-weight: bold;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .card-image-container {
                width: 100%;
                height: 220px;
                position: relative;
                background: linear-gradient(45deg, #2a2a2a, #3a3a3a);
                border-bottom: 2px solid #444;
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .card-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: transform 0.3s ease;
                opacity: 0.9;
            }

            .card:hover .card-image {
                transform: scale(1.05);
                opacity: 1;
            }

            .placeholder-image {
                color: #666;
                font-size: 48px;
                text-align: center;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                background: linear-gradient(45deg, #1a1a1a, #2a2a2a);
            }

            .placeholder-text {
                font-size: 12px;
                margin-top: 10px;
                color: #555;
            }

            .conditions-section {
                background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
                padding: 8px 12px;
                border-bottom: 1px solid #444;
                font-size: 10px;
            }

            .conditions-header {
                color: #888;
                font-weight: bold;
                margin-bottom: 4px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .condition-item {
                display: inline-block;
                background: rgba(255, 100, 100, 0.2);
                border: 1px solid #666;
                border-radius: 4px;
                padding: 2px 6px;
                margin: 1px;
                color: #ccc;
                font-size: 9px;
            }

            .card-setup {
                padding: 12px;
                font-size: 12px;
                line-height: 1.4;
                text-align: justify;
                color: #d0d0d0;
                background: rgba(0, 0, 0, 0.3);
                min-height: 60px;
                border-bottom: 1px solid #444;
            }

            .trigger-symptoms {
                padding: 8px 12px;
                font-size: 10px;
                color: #ccc;
                background: rgba(150, 50, 50, 0.2);
                border-bottom: 1px solid #444;
                min-height: 25px;
            }

            .triggers-header {
                font-weight: bold;
                margin-bottom: 4px;
                text-transform: uppercase;
                font-size: 9px;
                color: #ff9999;
            }

            .trigger-symptom {
                display: inline-block;
                background: rgba(255, 100, 100, 0.3);
                border: 1px solid #ff6666;
                border-radius: 3px;
                padding: 2px 6px;
                margin: 1px;
                font-size: 9px;
                color: #ffcccc;
            }

            .scenario-id {
                padding: 6px 12px;
                font-size: 10px;
                font-style: italic;
                color: #777;
                text-align: center;
                background: rgba(0, 0, 0, 0.4);
                border-radius: 0 0 15px 15px;
                min-height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-grow: 1;
            }

            .card-border-glow {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                border-radius: 15px;
                background: linear-gradient(45deg, #444, #666, #444);
                z-index: -1;
                filter: blur(8px);
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .card:hover .card-border-glow {
                opacity: 0.5;
            }

            .loading {
                padding: 40px;
                text-align: center;
                font-size: 20px;
                color: #e0e0e0;
                background: rgba(0, 0, 0, 0.7);
                border-radius: 10px;
                margin: 20px;
                border: 1px solid #444;
            }

            .error {
                padding: 30px;
                text-align: center;
                color: #ff6b6b;
                font-size: 16px;
                background: rgba(255, 0, 0, 0.1);
                border: 2px solid #ff6b6b;
                border-radius: 10px;
                margin: 20px;
            }

            .cards-container {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: flex-start;
                gap: 20px;
                padding: 20px;
            }

            @keyframes cardAppear {
                from {
                    opacity: 0;
                    transform: translateY(30px) rotateX(30deg);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) rotateX(0);
                }
            }

            .card {
                animation: cardAppear 0.8s ease-out forwards;
            }

            .render-button {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 24px;
                background: linear-gradient(135deg, #444, #666);
                color: #e0e0e0;
                border: 1px solid #666;
                border-radius: 8px;
                cursor: pointer;
                font-weight: bold;
                z-index: 1000;
                transition: all 0.3s ease;
            }

            .render-button:hover {
                background: linear-gradient(135deg, #555, #777);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            }

            .card-id {
                position: absolute;
                top: 8px;
                left: 10px;
                background: rgba(0, 0, 0, 0.6);
                color: #999;
                padding: 2px 6px;
                border-radius: 4px;
                font-size: 9px;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div id="loading" class="loading">
            üÉè Loading psychosis spectrum cards...
        </div>
        <div id="error" class="error" style="display: none"></div>

        <div class="cards-container" id="cardsContainer"></div>

        <script>
            let cards = [];

            // Function to load cards from JSON file
            async function loadCards() {
                try {
                    const response = await fetch("./schizophrenic-cards.json");
                    if (!response.ok) {
                        throw new Error(
                            `HTTP error! status: ${response.status}`,
                        );
                    }
                    const data = await response.json();
                    cards = Array.isArray(data) ? data : [];
                    console.log("Loaded cards:", cards);
                    document.getElementById("loading").style.display = "none";
                    initializeCards();
                } catch (error) {
                    console.error("Error loading cards:", error);
                    document.getElementById("loading").style.display = "none";
                    const errorElement = document.getElementById("error");
                    errorElement.style.display = "block";
                    errorElement.textContent = `Failed to load cards.json: ${error.message}`;
                }
            }

            // Function to create condition elements
            function createConditionElements(conditions) {
                const conditionsContainer = document.createElement("div");

                if (!conditions || typeof conditions !== "object") {
                    return conditionsContainer;
                }

                // Filter out trigger_symptoms as we'll display them separately
                const filteredConditions = Object.entries(conditions).filter(
                    ([key]) => key !== "trigger_symptoms",
                );

                filteredConditions.forEach(([key, value]) => {
                    const conditionItem = document.createElement("div");
                    conditionItem.className = "condition-item";
                    conditionItem.textContent = `${key.replace(/_/g, " ")}: ${value}`;
                    conditionsContainer.appendChild(conditionItem);
                });

                return conditionsContainer;
            }

            // Function to create trigger symptom elements
            function createTriggerElements(triggerSymptoms) {
                const triggerContainer = document.createElement("div");

                if (
                    !triggerSymptoms ||
                    !Array.isArray(triggerSymptoms) ||
                    triggerSymptoms.length === 0
                ) {
                    return null;
                }

                triggerSymptoms.forEach((symptom) => {
                    const triggerDiv = document.createElement("div");
                    triggerDiv.className = "trigger-symptom";
                    triggerDiv.textContent = symptom.replace(/_/g, " ");
                    triggerContainer.appendChild(triggerDiv);
                });

                return triggerContainer;
            }

            // Function to get placeholder icon based on scenario
            function getPlaceholderIcon(scenarioId) {
                const iconMap = {
                    auditory_disturbance: "üîä",
                    visual_disturbance: "üëÅÔ∏è",
                    paranoid_thoughts: "üß†",
                    sensory_overload: "‚ö°",
                    dissociation_episode: "üåÄ",
                    thought_disorganization: "üß©",
                    surveillance_delusion: "üëÄ",
                    affective_flattening: "üò∂",
                    speech_disorganization: "üí¨",
                    movement_disruption: "üö´",
                    self_dissolution: "ü™û",
                    delusional_thinking: "üï∏Ô∏è",
                    imperative_hallucinations: "üì¢",
                    temporal_confusion: "‚è∞",
                    telepathic_delusion: "üß†",
                    body_sensations: "‚úã",
                    inflated_importance: "üëë",
                    personal_references: "üëÅÔ∏è‚Äçüó®Ô∏è",
                    foreign_thoughts: "üí≠",
                    reflection_confusion: "ü™û",
                    phantom_smells: "üëÉ",
                    stolen_thoughts: "üîì",
                    persecution_complex: "üèÉ",
                    repetitive_speech: "üîÑ",
                    self_detachment: "üëª",
                    phantom_tastes: "üëÖ",
                    communication_withdrawal: "ü§ê",
                    constant_alertness: "üö®",
                    unusual_actions: "ü§π",
                    information_overload: "üåä",
                };
                return iconMap[scenarioId] || "üé¥";
            }

            // Function to create a card element
            function createCard(cardData, index) {
                const cardElement = document.createElement("div");
                cardElement.className = "card";
                cardElement.id = `card-${index}`;
                cardElement.style.animationDelay = `${index * 0.1}s`;

                // Create card structure
                cardElement.innerHTML = `
                    <div class="card-border-glow"></div>
                    <div class="card-id">#${cardData.id}</div>
                    <div class="card-header">
                        <h3 class="card-name">${cardData.card_name || "Unknown Card"}</h3>
                        <div class="card-title">${cardData.title || ""}</div>
                        <div class="card-type">${cardData.card_type || "spectrum"}</div>
                    </div>

                    <div class="card-image-container">
                        <div class="placeholder-image">
                            <div>${getPlaceholderIcon(cardData.scenario_id)}</div>
                            <div class="placeholder-text">Generated Image</div>
                        </div>
                    </div>

                    <div class="conditions-section">
                        <div class="conditions-header">Conditions</div>
                        <div class="conditions-list"></div>
                    </div>

                    <div class="trigger-symptoms" style="display: none;">
                        <div class="triggers-header">Trigger Symptoms</div>
                        <div class="trigger-list"></div>
                    </div>
                `;

                // Add conditions
                const conditionsListElement =
                    cardElement.querySelector(".conditions-list");
                const conditionsElements = createConditionElements(
                    cardData.conditions,
                );
                conditionsListElement.appendChild(conditionsElements);

                // Add trigger symptoms if they exist
                if (
                    cardData.conditions &&
                    cardData.conditions.trigger_symptoms
                ) {
                    const triggerElement =
                        cardElement.querySelector(".trigger-symptoms");
                    const triggerListElement =
                        cardElement.querySelector(".trigger-list");
                    const triggerElements = createTriggerElements(
                        cardData.conditions.trigger_symptoms,
                    );

                    if (triggerElements) {
                        triggerListElement.appendChild(triggerElements);
                        triggerElement.style.display = "block";
                    }
                }

                // Try to load actual image
                const imageContainer = cardElement.querySelector(
                    ".card-image-container",
                );
                const img = document.createElement("img");
                img.className = "card-image";
                img.src = `schizo-images/card-picture-${index}.png`;
                img.alt = `Artwork for ${cardData.card_name}`;

                img.onload = function () {
                    imageContainer.innerHTML = "";
                    imageContainer.appendChild(img);
                };

                img.onerror = function () {
                    // Keep placeholder if image fails to load
                    console.log(
                        `Image not found for card ${index}, keeping placeholder`,
                    );
                };

                return cardElement;
            }

            // Function to render cards as images
            function renderCards() {
                console.log("Rendering cards to images...");
                document
                    .querySelectorAll(".card")
                    .forEach((cardElement, index) => {
                        html2canvas(cardElement, {
                            width: 300,
                            height: 480,
                            scale: 2,
                            useCORS: true,
                            allowTaint: true,
                            backgroundColor: null,
                        })
                            .then((canvas) => {
                                const imgData = canvas.toDataURL("image/png");
                                const link = document.createElement("a");
                                link.href = imgData;
                                link.download = `card-${index}.png`;
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);
                                console.log(
                                    `Rendered card ${index}: ${cards[index].card_name}`,
                                );
                            })
                            .catch((error) => {
                                console.error(
                                    `Error rendering card ${index}:`,
                                    error,
                                );
                            });
                    });
            }

            // Initialize cards after loading from JSON
            function initializeCards() {
                const container = document.getElementById("cardsContainer");

                if (!cards || cards.length === 0) {
                    container.innerHTML =
                        '<div class="error">No cards found in cards.json</div>';
                    return;
                }

                // Clear existing cards
                container.innerHTML = "";

                // Create cards
                cards.forEach((cardData, index) => {
                    const cardElement = createCard(cardData, index);
                    container.appendChild(cardElement);
                });

                console.log(`Loaded ${cards.length} cards`);

                // Add render button
                if (!document.getElementById("renderButton")) {
                    const renderButton = document.createElement("button");
                    renderButton.id = "renderButton";
                    renderButton.className = "render-button";
                    renderButton.textContent = "Download All Cards as Images";
                    renderButton.onclick = renderCards;
                    document.body.appendChild(renderButton);
                }
            }

            // Load cards when page loads
            window.addEventListener("DOMContentLoaded", loadCards);
        </script>
    </body>
</html>

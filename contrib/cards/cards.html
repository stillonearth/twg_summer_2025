<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MTG-Style Card Game</title>
        <script src="./html2canvas.js"></script>
        <style>
            body {
                background: linear-gradient(135deg, #1a1a2e, #16213e);
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 20px;
                min-height: 100vh;
            }

            .card {
                width: 280px;
                height: 392px;
                border-radius: 12px;
                box-shadow:
                    0 8px 25px rgba(0, 0, 0, 0.6),
                    0 0 0 2px #d4af37;
                margin: 15px;
                display: inline-block;
                background: linear-gradient(145deg, #f8f6f0, #e8e6e0);
                position: relative;
                overflow: hidden;
                transition:
                    transform 0.3s ease,
                    box-shadow 0.3s ease;
            }

            .card:hover {
                transform: translateY(-5px) scale(1.02);
                box-shadow:
                    0 12px 35px rgba(0, 0, 0, 0.8),
                    0 0 0 3px #ffd700;
            }

            .card-header {
                background: linear-gradient(135deg, #2c3e50, #34495e);
                border-radius: 12px 12px 0 0;
                padding: 8px 12px;
                position: relative;
                border-bottom: 2px solid #d4af37;
            }

            .card-title {
                color: #fff;
                font-size: 16px;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
                margin: 0;
                text-align: center;
            }

            .card-type {
                position: absolute;
                top: 5px;
                right: 8px;
                background: rgba(255, 215, 0, 0.9);
                color: #2c3e50;
                padding: 2px 6px;
                border-radius: 4px;
                font-size: 10px;
                font-weight: bold;
                text-transform: uppercase;
            }

            .card-image-container {
                width: 100%;
                height: 160px;
                position: relative;
                background: linear-gradient(45deg, #667eea, #764ba2);
                border-bottom: 2px solid #d4af37;
                overflow: hidden;
            }

            .card-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: transform 0.3s ease;
            }

            .card:hover .card-image {
                transform: scale(1.05);
            }

            .resource-effects {
                background: linear-gradient(135deg, #2c3e50, #34495e);
                padding: 8px;
                border-bottom: 1px solid #d4af37;
            }

            .resource-grid {
                display: flex;
                justify-content: space-around;
                align-items: center;
                flex-wrap: wrap;
                gap: 4px;
            }

            .resource-item {
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid #d4af37;
                border-radius: 6px;
                padding: 3px 6px;
                color: #fff;
                font-size: 11px;
                font-weight: bold;
                text-align: center;
                min-width: 45px;
                backdrop-filter: blur(5px);
            }

            .resource-food {
                background: rgba(255, 165, 0, 0.2);
                border-color: #ffa500;
            }

            .resource-health {
                background: rgba(255, 99, 132, 0.2);
                border-color: #ff6384;
            }

            .resource-mental {
                background: rgba(54, 162, 235, 0.2);
                border-color: #36a2eb;
            }

            .resource-icon {
                font-size: 12px;
                margin-right: 2px;
            }

            .card-effect {
                padding: 10px;
                font-size: 12px;
                line-height: 1.4;
                text-align: justify;
                color: #2c3e50;
                background: rgba(255, 255, 255, 0.8);
                min-height: 60px;
                border-bottom: 1px solid #d4af37;
            }

            .card-flavor {
                padding: 8px 10px;
                font-size: 10px;
                font-style: italic;
                color: #6c757d;
                text-align: center;
                background: rgba(248, 249, 250, 0.9);
                border-radius: 0 0 12px 12px;
                min-height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .card-border-glow {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                border-radius: 12px;
                background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
                z-index: -1;
                filter: blur(8px);
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .card:hover .card-border-glow {
                opacity: 0.7;
            }

            .loading {
                padding: 40px;
                text-align: center;
                font-size: 20px;
                color: #fff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                margin: 20px;
            }

            .error {
                padding: 30px;
                text-align: center;
                color: #ff6b6b;
                font-size: 16px;
                background: rgba(255, 0, 0, 0.1);
                border: 2px solid #ff6b6b;
                border-radius: 10px;
                margin: 20px;
            }

            .cards-container {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: flex-start;
                gap: 20px;
                padding: 20px;
            }

            @keyframes cardAppear {
                from {
                    opacity: 0;
                    transform: translateY(30px) rotateX(30deg);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) rotateX(0);
                }
            }

            .card {
                animation: cardAppear 0.6s ease-out forwards;
            }
        </style>
    </head>
    <body>
        <div id="loading" class="loading">🎴 Loading magical cards...</div>
        <div id="error" class="error" style="display: none"></div>

        <div class="cards-container" id="cardsContainer"></div>

        <div class="card" id="cardTemplate" style="display: none">
            <div class="card-border-glow"></div>
            <div class="card-header">
                <h3 class="card-title">{{name}}</h3>
                <div class="card-type">{{card_type}}</div>
            </div>

            <div class="card-image-container">
                <img class="card-image" alt="Card artwork" />
            </div>

            <div class="resource-effects">
                <div class="resource-grid" id="resourceGrid">
                    <!-- Resource effects will be populated here -->
                </div>
            </div>

            <div class="card-effect"><strong>Effect:</strong>{{effect}</div>

            <div class="card-flavor">"{{flavorText}}"</div>
        </div>

        <script>
            let cards = [];

            // Sample card data for demonstration
            const sampleCards = [
                {
                    name: "Mystic Forest Guardian",
                    card_type: "Creature",
                    flavor_text:
                        "In the depths of the ancient woods, guardians watch over nature's secrets.",
                    resource_effects: {
                        food: 50.0,
                        health: 15.0,
                        mental: 10.0,
                    },
                },
                {
                    name: "Lightning Bolt",
                    card_type: "Spell",
                    flavor_text:
                        "A flash of pure energy that can change the course of battle.",
                    resource_effects: {
                        mental: 25.0,
                        health: -10.0,
                    },
                },
                {
                    name: "Healing Potion",
                    card_type: "Artifact",
                    flavor_text:
                        "The warm glow of restoration flows through your veins.",
                    resource_effects: {
                        health: 40.0,
                    },
                },
            ];

            // Function to load cards from JSON file or use sample data
            async function loadCards() {
                try {
                    const response = await fetch("./cards.json");
                    if (!response.ok) {
                        console.log("No cards.json found, using sample data");
                        cards = sampleCards;
                    } else {
                        const data = await response.json();
                        cards = data;
                    }
                    document.getElementById("loading").style.display = "none";
                    initializeCards();
                } catch (error) {
                    console.log(
                        "Error loading cards, using sample data:",
                        error,
                    );
                    cards = sampleCards;
                    document.getElementById("loading").style.display = "none";
                    initializeCards();
                }
            }

            // Function to create resource effect elements
            function createResourceEffects(resourceEffects) {
                const resourceGrid = document.createElement("div");
                resourceGrid.className = "resource-grid";

                if (!resourceEffects) return resourceGrid;

                const resourceTypes = {
                    food: { icon: "🍎", class: "resource-food" },
                    health: { icon: "❤️", class: "resource-health" },
                    mental: { icon: "🧠", class: "resource-mental" },
                };

                for (const [type, value] of Object.entries(resourceEffects)) {
                    if (value !== 0) {
                        const resourceItem = document.createElement("div");
                        resourceItem.className = `resource-item ${resourceTypes[type]?.class || ""}`;

                        const icon = resourceTypes[type]?.icon || "⚡";
                        const sign = value > 0 ? "+" : "";
                        resourceItem.innerHTML = `<span class="resource-icon">${icon}</span>${sign}${value}`;

                        resourceGrid.appendChild(resourceItem);
                    }
                }

                return resourceGrid;
            }

            // Function to create a card element
            function createCard(card, index) {
                const template = document.getElementById("cardTemplate");
                const clone = template.cloneNode(true);

                clone.style.display = "block";
                clone.id = `card-${index}`;

                // Set card content
                clone.querySelector(".card-title").textContent =
                    card.name || "Unknown Card";
                clone.querySelector(".card-type").textContent =
                    card.card_type || "Unknown";
                clone.querySelector(".card-flavor").textContent =
                    `"${card.flavor_text || "No flavor text available."}"`;
                clone.querySelector(".card-effect").textContent =
                    `"${card.effect || "No effect text available."}"`;

                // Set card image
                const imageElement = clone.querySelector(".card-image");
                let imageFile = `processed_images/card-picture-${index}.png`;
                imageElement.src = imageFile;
                imageElement.onerror = function () {
                    // Fallback to a placeholder if image doesn't exist
                    this.src =
                        "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgwIiBoZWlnaHQ9IjE2MCIgdmlld0JveD0iMCAwIDI4MCAxNjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyODAiIGhlaWdodD0iMTYwIiBmaWxsPSJ1cmwoI2dyYWRpZW50KSIvPgo8dGV4dCB4PSIxNDAiIHk9IjgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiPkNhcmQgQXJ0d29yazwvdGV4dD4KPGR1ZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgo8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjNjY3ZWVhIi8+CjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzc2NGJhMiIvPgo8L2xpbmVhckdyYWRpZW50Pgo8L2RlZnM+Cjwvc3ZnPgo=";
                };

                // Create and replace resource effects
                const resourceContainer = clone.querySelector(
                    ".resource-effects .resource-grid",
                );
                const newResourceGrid = createResourceEffects(
                    card.resource_effects,
                );
                resourceContainer.parentNode.replaceChild(
                    newResourceGrid,
                    resourceContainer,
                );

                return clone;
            }

            function renderCards() {
                console.log("rendering cards");
                document
                    .querySelectorAll(".card")
                    .forEach((cardElement, index) => {
                        if (index == 0) {
                            return;
                        }
                        html2canvas(cardElement).then((canvas) => {
                            const imgData = canvas
                                .toDataURL("image/png")
                                .replace("image/png", "image/octet-stream");

                            // Optionally download the image (if you want it saved locally)
                            const link = document.createElement("a");
                            link.href = imgData;
                            link.download = `card-${index}.png`;
                            link.click();
                        });
                    });
            }

            // Initialize cards after loading from JSON
            function initializeCards() {
                const container = document.getElementById("cardsContainer");

                // Use first 5 cards or all available cards
                const cardsToShow = cards.slice(0, Math.max(5, cards.length));

                cardsToShow.forEach((cardData, index) => {
                    const cardElement = createCard(cardData, index);
                    cardElement.style.animationDelay = `${index * 0.1}s`;
                    container.appendChild(cardElement);
                });

                console.log(`Loaded ${cardsToShow.length} cards`);
            }

            // Load cards when page loads
            window.addEventListener("DOMContentLoaded", loadCards);

            setTimeout(renderCards, 5000);
        </script>
    </body>
</html>

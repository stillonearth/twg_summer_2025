<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Mental Health Scenario Cards</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(
                    135deg,
                    #0f172a 0%,
                    #1e293b 25%,
                    #334155 50%,
                    #475569 75%,
                    #64748b 100%
                );
                min-height: 100vh;
                padding: 20px;
                color: #ffffff;
                position: relative;
            }

            body::before {
                content: "";
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background:
                    radial-gradient(
                        circle at 25% 25%,
                        rgba(59, 130, 246, 0.1) 0%,
                        transparent 50%
                    ),
                    radial-gradient(
                        circle at 75% 75%,
                        rgba(147, 51, 234, 0.1) 0%,
                        transparent 50%
                    );
                pointer-events: none;
                z-index: -1;
            }

            .header {
                text-align: center;
                margin-bottom: 40px;
                position: relative;
            }

            .header h1 {
                font-size: 3rem;
                font-weight: 300;
                margin-bottom: 15px;
                background: linear-gradient(135deg, #60a5fa, #a78bfa, #f472b6);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                text-shadow: 0 0 30px rgba(96, 165, 250, 0.5);
            }

            .header p {
                color: #cbd5e1;
                font-size: 1.2rem;
                opacity: 0.9;
            }

            .controls {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin-bottom: 40px;
                flex-wrap: wrap;
            }

            .control-btn {
                padding: 15px 30px;
                background: linear-gradient(135deg, #1e40af, #3730a3, #1e3a8a);
                border: none;
                border-radius: 25px;
                color: white;
                cursor: pointer;
                font-size: 1rem;
                font-weight: 600;
                transition: all 0.3s ease;
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
                position: relative;
                overflow: hidden;
            }

            .control-btn::before {
                content: "";
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.2),
                    transparent
                );
                transition: left 0.5s;
            }

            .control-btn:hover::before {
                left: 100%;
            }

            .control-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 12px 35px rgba(59, 130, 246, 0.6);
                background: linear-gradient(135deg, #2563eb, #4338ca, #3730a3);
            }

            .cards-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: 30px;
                max-width: 1600px;
                margin: 0 auto;
                padding: 20px;
            }

            .card {
                width: 320px;
                height: 500px;
                border-radius: 20px;
                background: linear-gradient(145deg, #1e293b, #334155, #475569);
                box-shadow:
                    0 15px 40px rgba(0, 0, 0, 0.6),
                    0 0 0 1px rgba(148, 163, 184, 0.1),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
                position: relative;
                overflow: hidden;
                transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
                cursor: pointer;
                margin: 0 auto;
            }

            .card::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(
                    135deg,
                    rgba(59, 130, 246, 0.1),
                    rgba(147, 51, 234, 0.1)
                );
                opacity: 0;
                transition: opacity 0.3s ease;
                border-radius: 20px;
            }

            .card:hover::before {
                opacity: 1;
            }

            .card:hover {
                transform: translateY(-10px) scale(1.02);
                box-shadow:
                    0 25px 60px rgba(0, 0, 0, 0.8),
                    0 0 0 2px rgba(59, 130, 246, 0.3),
                    0 0 40px rgba(59, 130, 246, 0.2);
            }

            .card-header {
                background: linear-gradient(135deg, #0f172a, #1e293b, #334155);
                border-radius: 20px 20px 0 0;
                padding: 20px;
                position: relative;
                border-bottom: 2px solid rgba(148, 163, 184, 0.2);
            }

            .card-id {
                position: absolute;
                top: 15px;
                left: 20px;
                background: rgba(59, 130, 246, 0.8);
                color: white;
                padding: 4px 10px;
                border-radius: 12px;
                font-size: 11px;
                font-weight: bold;
                backdrop-filter: blur(10px);
            }

            .card-type {
                position: absolute;
                top: 15px;
                right: 20px;
                background: linear-gradient(135deg, #7c3aed, #a855f7);
                color: white;
                padding: 6px 12px;
                border-radius: 15px;
                font-size: 10px;
                font-weight: bold;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                max-width: 120px;
                text-align: center;
                line-height: 1.2;
            }

            .card-name {
                color: #f8fafc;
                font-size: 20px;
                font-weight: 700;
                margin: 25px 0 8px 0;
                text-align: center;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            }

            .card-title {
                color: #cbd5e1;
                font-size: 14px;
                font-weight: 500;
                font-style: italic;
                text-align: center;
                opacity: 0.9;
            }

            .card-image-container {
                width: 100%;
                height: 180px;
                position: relative;
                background: linear-gradient(45deg, #1e293b, #334155);
                border-bottom: 2px solid rgba(148, 163, 184, 0.2);
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .card-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: transform 0.4s ease;
                opacity: 0.95;
            }

            .card:hover .card-image {
                transform: scale(1.1);
                opacity: 1;
            }

            .placeholder-image {
                color: #94a3b8;
                font-size: 60px;
                text-align: center;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                background: linear-gradient(45deg, #1e293b, #334155, #475569);
            }

            .placeholder-text {
                font-size: 14px;
                margin-top: 15px;
                color: #64748b;
                font-weight: 500;
            }

            .card-content {
                padding: 20px;
                height: calc(100% - 260px);
                display: flex;
                flex-direction: column;
            }

            .setup-section {
                background: rgba(30, 41, 59, 0.6);
                padding: 15px;
                border-radius: 12px;
                margin-bottom: 15px;
                border: 1px solid rgba(148, 163, 184, 0.1);
                backdrop-filter: blur(5px);
            }

            .setup-text {
                font-size: 13px;
                line-height: 1.5;
                color: #e2e8f0;
                text-align: justify;
            }

            .trigger-symptoms {
                flex-grow: 1;
                display: flex;
                flex-direction: column;
            }

            .triggers-header {
                font-weight: 700;
                margin-bottom: 10px;
                font-size: 12px;
                color: #f1c2c2;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .trigger-list {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }

            .trigger-symptom {
                background: linear-gradient(
                    135deg,
                    rgba(239, 68, 68, 0.8),
                    rgba(220, 38, 38, 0.8)
                );
                border: 1px solid rgba(239, 68, 68, 0.6);
                border-radius: 20px;
                padding: 6px 12px;
                font-size: 10px;
                color: white;
                font-weight: 600;
                text-transform: capitalize;
                backdrop-filter: blur(5px);
                transition: all 0.2s ease;
            }

            .trigger-symptom:hover {
                transform: scale(1.05);
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
            }

            .scenario-id {
                position: absolute;
                bottom: 15px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 11px;
                font-style: italic;
                color: #94a3b8;
                text-align: center;
                background: rgba(30, 41, 59, 0.8);
                padding: 6px 15px;
                border-radius: 15px;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(148, 163, 184, 0.2);
            }

            .loading {
                padding: 60px;
                text-align: center;
                font-size: 24px;
                color: #f8fafc;
                background: linear-gradient(
                    135deg,
                    rgba(30, 41, 59, 0.9),
                    rgba(51, 65, 85, 0.9)
                );
                border-radius: 20px;
                margin: 40px auto;
                max-width: 600px;
                border: 2px solid rgba(59, 130, 246, 0.3);
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(10px);
            }

            .error {
                padding: 40px;
                text-align: center;
                color: #fca5a5;
                font-size: 18px;
                background: linear-gradient(
                    135deg,
                    rgba(127, 29, 29, 0.9),
                    rgba(153, 27, 27, 0.9)
                );
                border: 2px solid #ef4444;
                border-radius: 20px;
                margin: 40px auto;
                max-width: 600px;
                box-shadow: 0 20px 40px rgba(239, 68, 68, 0.3);
                backdrop-filter: blur(10px);
            }

            @keyframes cardAppear {
                from {
                    opacity: 0;
                    transform: translateY(50px) rotateX(20deg);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) rotateX(0);
                }
            }

            .card {
                animation: cardAppear 0.8s ease-out forwards;
            }

            @keyframes pulseGlow {
                0%,
                100% {
                    box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
                }
                50% {
                    box-shadow: 0 0 40px rgba(59, 130, 246, 0.8);
                }
            }

            .card:hover {
                animation: pulseGlow 2s infinite;
            }

            @media (max-width: 768px) {
                .header h1 {
                    font-size: 2rem;
                }

                .controls {
                    flex-direction: column;
                    align-items: center;
                }

                .cards-container {
                    grid-template-columns: 1fr;
                    padding: 10px;
                }

                .card {
                    width: 100%;
                    max-width: 320px;
                }
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>Mental Health Scenario Cards</h1>
            <p>Interactive diagnostic and educational card collection</p>
        </div>

        <div class="controls">
            <button class="control-btn" onclick="renderCards()">
                💾 Download All Cards
            </button>
        </div>

        <div id="loading" class="loading">
            🧠 Loading mental health scenario cards...
        </div>
        <div id="error" class="error" style="display: none"></div>

        <div class="cards-container" id="cardsContainer"></div>

        <script>
            let cardsData = [];

            // Function to get placeholder icon based on scenario
            function getPlaceholderIcon(scenarioId) {
                const iconMap = {
                    auditory_disturbance: "🔊",
                    visual_disturbance: "👁️",
                    paranoid_thoughts: "🧠",
                    sensory_overload: "⚡",
                    dissociation_episode: "🌀",
                    thought_disorganization: "🧩",
                    surveillance_delusion: "👀",
                    affective_flattening: "😶",
                    speech_disorganization: "💬",
                    movement_disruption: "🚫",
                    self_dissolution: "🪞",
                    delusional_thinking: "🕸️",
                    imperative_hallucinations: "📢",
                    temporal_confusion: "⏰",
                    telepathic_delusion: "🧠",
                    body_sensations: "✋",
                    inflated_importance: "👑",
                    personal_references: "👁️‍🗨️",
                    foreign_thoughts: "💭",
                    reflection_confusion: "🪞",
                    phantom_smells: "👃",
                    stolen_thoughts: "🔓",
                    persecution_complex: "🏃",
                    repetitive_speech: "🔄",
                    self_detachment: "👻",
                    phantom_tastes: "👅",
                    communication_withdrawal: "🤐",
                    constant_alertness: "🚨",
                    unusual_actions: "🤹",
                    information_overload: "🌊",
                    mild_social_fear: "😰",
                    mild_mania: "🚀",
                    low_mood: "☁️",
                    unwanted_thoughts: "💭",
                    executive_dysfunction: "⏸️",
                    performance_pressure: "🎯",
                    emotional_dysregulation: "🌊",
                    self_doubt: "❓",
                    exhaustion_state: "😴",
                    cognitive_cloudiness: "🌫️",
                };
                return iconMap[scenarioId] || "🎴";
            }

            // Function to create a card element
            function createCard(cardData, index) {
                const cardElement = document.createElement("div");
                cardElement.className = "card";
                cardElement.id = `card-${index}`;
                cardElement.style.animationDelay = `${index * 0.1}s`;

                const triggerSymptoms =
                    cardData.conditions?.trigger_symptoms || [];

                cardElement.innerHTML = `
                <div class="card-header">
                    <h3 class="card-name">${cardData.card_name || "Unknown Card"}</h3>
                    <div class="card-title">${cardData.title || ""}</div>
                </div>

                <div class="card-image-container">
                    <div class="placeholder-image">
                        <div style="font-size: 60px;">${getPlaceholderIcon(cardData.scenario_id)}</div>
                        <div class="placeholder-text">${cardData.scenario_id || "scenario"}</div>
                    </div>
                </div>

                <div class="card-content">
                    <div class="setup-section">
                        <div class="setup-text">${cardData.flavor_text || "No setup description available."}</div>
                    </div>

                    ${
                        triggerSymptoms.length > 0
                            ? `
                        <div class="trigger-symptoms">
                            <div class="triggers-header">Trigger Symptoms</div>
                            <div class="trigger-list">
                                ${triggerSymptoms
                                    .map(
                                        (symptom) =>
                                            `<div class="trigger-symptom">${symptom.replace(/_/g, " ")}</div>`,
                                    )
                                    .join("")}
                            </div>
                        </div>
                    `
                            : ""
                    }
                </div>

            `;

                // Try to load actual image
                const imageContainer = cardElement.querySelector(
                    ".card-image-container",
                );
                const img = document.createElement("img");
                img.className = "card-image";
                img.src = `schizo-images/card-picture-${cardData.id}.png`;
                img.alt = `Artwork for ${cardData.card_name}`;

                img.onload = function () {
                    imageContainer.innerHTML = "";
                    imageContainer.appendChild(img);
                };

                img.onerror = function () {
                    // Keep placeholder if image fails to load
                    console.log(
                        `Image not found for card ${cardData.id}, keeping placeholder`,
                    );
                };

                return cardElement;
            }

            // Function to initialize cards after loading from JSON
            function initializeCards() {
                const container = document.getElementById("cardsContainer");

                if (!cardsData || cardsData.length === 0) {
                    container.innerHTML =
                        '<div class="error">No cards found in JSON data</div>';
                    return;
                }

                // Clear existing cards
                container.innerHTML = "";

                // Create cards
                cardsData.forEach((cardData, index) => {
                    const cardElement = createCard(cardData, index);
                    container.appendChild(cardElement);
                });

                console.log(`Loaded ${cardsData.length} cards`);
            }

            // Utility functions removed (shuffle and filter)

            // Function to render cards as images
            function renderCards() {
                if (cardsData.length === 0) {
                    alert("No cards loaded to render!");
                    return;
                }

                console.log("Rendering cards to images...");
                let rendered = 0;

                document
                    .querySelectorAll(".card")
                    .forEach((cardElement, index) => {
                        html2canvas(cardElement, {
                            width: 320,
                            height: 500,
                            scale: 2,
                            useCORS: true,
                            allowTaint: true,
                            backgroundColor: null,
                        })
                            .then((canvas) => {
                                const imgData = canvas.toDataURL("image/png");
                                const link = document.createElement("a");
                                link.href = imgData;
                                link.download = `card-${cardsData[index].id}.png`;
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);
                                rendered++;
                                console.log(
                                    `Rendered card ${index}: ${cardsData[index].card_name}`,
                                );
                            })
                            .catch((error) => {
                                console.error(
                                    `Error rendering card ${index}:`,
                                    error,
                                );
                            });
                    });
            }

            async function loadCards() {
                try {
                    const response = await fetch("./schizophrenic-cards.json");
                    if (!response.ok) {
                        throw new Error(
                            `HTTP error! status: ${response.status}`,
                        );
                    }
                    const data = await response.json();
                    cardsData = Array.isArray(data) ? data : [];
                    console.log("Loaded cards:", cardsData);
                    document.getElementById("loading").style.display = "none";
                    initializeCards();
                } catch (error) {
                    console.error("Error loading cards:", error);
                    document.getElementById("loading").style.display = "none";
                    const errorElement = document.getElementById("error");
                    errorElement.style.display = "block";
                    errorElement.innerHTML = `
                       <h3>🚫 Failed to load cards</h3>
                       <p>Could not load schizophrenic-cards.json: ${error.message}</p>
                       <p>Please ensure the JSON file is in the same directory as this HTML file.</p>
                   `;
                }
            }

            // Load cards when page loads
            window.addEventListener("DOMContentLoaded", loadCards);
        </script>
    </body>
</html>
